<!DOCTYPE html>
<html lang="en" ng-app="thumbnail">
<head>
    <meta http-equiv="Content-Security-Policy" script-src='unsafe-inline';>
    <title>A proper Angular HelloWorld app </title>
    <link href="css/main.css" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" />
    <script src = "https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js">
    </script>
<script src="js/scripts.js"></script>
<script src="../js/components/home.component.js"></script>
<!--    <embed src="assets/icons/image.txt" width="800px" height="2100px" />-->
</head>
<body ng-app = "myApp">

<div ng-controller = "myCtrl">
</div>
<script src="//mozilla.github.io/pdf.js/build/pdf.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>

<h1>Thumbnail for pdf</h1>

<div>

    <span id="page_count"></span>
</div>
<form>

    <label for="pdf">Pdf url:</label>
     <input type="url" id="pdf" name="pdf" required/>
<!--    <button onclick="clickOnPdf()"> url </button> <br>-->

</form>
<!--<div>Screenshot tester</div>-->
<!--<h1>thumbnail of pdf</h1>-->
<button onclick="report()">display thumbnail</button>
<!--<button onclick="clickOnPdf()">display thumbnail</button>-->
<div class="container">
    <img width="25%" class="screen">
</div>


<canvas onclick="downloadFile()" id="the-canvas"></canvas>

<script>

var url = 'https://raw.githubusercontent.com/mozilla/pdf.js/ba2edeae/web/compressed.tracemonkey-pldi-09.pdf';

// Loaded via <script> tag, create shortcut to access PDF.js exports.
var pdfjsLib = window['pdfjs-dist/build/pdf'];

// The workerSrc property shall be specified.
pdfjsLib.GlobalWorkerOptions.workerSrc = '//mozilla.github.io/pdf.js/build/pdf.worker.js';

var pdfDoc = null,
    pageNum = 1,
    pageRendering = false,
    pageNumPending = null,
    scale = 0.4,
    canvas = document.getElementById('the-canvas'),
    ctx = canvas.getContext('2d');

/**
 * Get page info from document, resize canvas accordingly, and render page.
 * @param num Page number.
 */
function renderPage(num) {
  pageRendering = true;
  // Using promise to fetch the page
  pdfDoc.getPage(num).then(function(page) {
    var viewport = page.getViewport({scale: scale});
    canvas.height = viewport.height;
    canvas.width = viewport.width;

    // Render PDF page into canvas context
    var renderContext = {
      canvasContext: ctx,
      viewport: viewport
    };
    var renderTask = page.render(renderContext);

    // Wait for rendering to finish
 /*    renderTask.promise.then(function() {
     pageRendering = false;
      if (pageNumPending !== null) {
        // New page rendering is pending
        renderPage(pageNumPending);
        pageNumPending = null;
      }
    }); */
  });
}

/**
 * Asynchronously downloads PDF.
 */
pdfjsLib.getDocument(url).promise.then(function(pdfDoc_) {
  pdfDoc = pdfDoc_;
  /* document.getElementById('page_count').textContent = pdfDoc.numPages */

  // Initial/first page rendering
  renderPage(pageNum);
});
function report() {
  let region = document.querySelector("canvas"); // whole screen
  html2canvas(region, {
    onrendered: function(canvas) {
      let pngUrl = canvas.toDataURL(); // png in dataURL format
      let img = document.querySelector(".screen");
      img.src = pngUrl;

      // here you can allow user to set bug-region
      // and send it with 'pngUrl' to server
    },
  });
}
function clickOnPdf(){
renderPage(pageNum);
}
function downloadFile(){
var link = document.createElement('a');
link.href = url;
link.download = 'file.pdf';
link.dispatchEvent(new MouseEvent('click'));
}

</script>
<home></home>
<div class="row" style="width:420px; left:20px; display: inline-block; margin-right: 40px;"/>
<div class="col s12 m4" style="width:100%;"/>
</body>
</html>